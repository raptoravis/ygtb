---
name: article-rewriter
description: Article rewriting style management tool. Manage writing styles, generate prompts for article rewriting, and maintain rewrite history. Use when you need to transform content to match a particular writing style.
---

# Article Rewriter

Manage writing styles, generate prompts for article rewriting, and maintain a history of rewrites.

## When to Use

Use this skill when you have:

- A target article that needs rewriting
- A style description (generated by style-generator or manually created)
- Optional additional instructions for fine-tuning
- Need to track and manage multiple rewrite attempts

## Workflow

### Standard Three-Step Workflow

1. **Generate Prompt**: Use the script to generate a complete LLM prompt and save to file
2. **Execute with LLM**: Send the prompt to an LLM externally and save the result
3. **Save to History**: Save the rewritten article to history for future reference

### Quick One-Step Workflow (for AI Assistant)

When this skill is invoked by an AI assistant, the assistant can:

1. Read the style description from saved style or provided text
2. Generate a complete rewrite prompt following the template
3. send the prompt
4. Return the rewritten article directly
5. Optionally save to rewrite history if requested

## Style Adherence Guidelines

When rewriting, the LLM MUST follow these principles:

### 1. Preserve Core Content

- Keep all key information and facts
- Maintain original message and intent
- Do not add or remove significant information

### 2. Apply Style Elements

- **Vocabulary**: Use words consistent with style description
- **Sentence Structure**: Match sentence length and complexity patterns
- **Tone**: Adopt emotional tone specified
- **Structure**: Follow opening/body/closing patterns described

### 3. Handle Special Instructions

If additional instructions are provided (e.g., "make it more concise", "add humor"):

- Apply these on top of style requirements
- Ensure they don't conflict with core style elements
- Prioritize style consistency over additional instructions if there's conflict

### 4. Natural Flow

- The rewrite should read naturally
- Avoid awkward phrasing that sacrifices clarity for style
- Maintain logical flow between paragraphs

## Command Line Usage

### List Available Styles

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py --list-styles
```

Output:

```
可用的风格:
  - 聊天
  - 幽默
  - 娓娓道来
  - 故事
  - 幽默短篇故事
```

### Standard Three-Step Workflow

#### Step 1: Generate Prompt and Save to File

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --input target_article.txt \
    --use-saved-style "幽默短篇故事" \
    --instructions "让文章更简洁" \
    --generate-prompt \
    --output prompt.txt
```

The script will save the complete prompt to `prompt.txt` and display it:

```text
你是一个专业的写作风格模仿专家，能够根据提供的风格描述准确模仿各种写作风格。

根据以下风格描述，用这种风格重写目标文章。

风格名称: 幽默短篇故事
风格描述: [风格描述内容...]

额外指令:
让文章更简洁

目标文章:
[文章内容...]

请严格按照上面的风格描述，重写目标文章，保持原文的核心内容不变。
```

#### Step 2: Execute LLM Externally

Copy the prompt from `prompt.txt` and send it to your LLM (ChatGPT, Claude, etc.). Save the LLM's response to a file:

```bash
# Example: Save LLM result to file
echo "重写后的文章内容..." > rewritten.txt
```

#### Step 3: Save to History for Future Reference

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --input target_article.txt \
    --use-saved-style "幽默短篇故事" \
    --save-to-history \
    --rewrite-result rewritten.txt \
    --notes "说服技巧主题"
```

This will:

1. Save the rewrite entry to `data/rewrite_history.json` with:
   - Original content (for reference)
   - Rewritten content
   - Style name used
   - Timestamp
   - Source files
   - Optional notes
2. Delete the `rewritten.txt` file automatically
3. Clean up any tracked temporary files (including `prompt.txt`)

### View Rewrite History

#### List All History

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py --list-history
```

This displays all saved rewrite entries with:

- Entry ID and timestamp
- Style name used
- Optional notes
- Preview of original content

#### List History by Style

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py --list-history --style "幽默"
```

This shows only rewrites done with the specified style.

History is stored independently from style reference articles in `data/rewrite_history.json`.

### Export History Entry

Export a specific rewrite entry's result to a file:

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --export-history 1 \
    --output exported_article.txt
```

Or print to console:

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py --export-history 1
```

### Delete History Entry

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py --delete-history 1
```

### Using Custom Style Description

Generate prompt with custom style description:

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --input target_article.txt \
    --style-description "风格描述文本..." \
    --style-name "自定义风格" \
    --generate-prompt \
    --output custom_prompt.txt
```

Or use a file for style description:

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --input target_article.txt \
    --style-description style_desc.txt \
    --generate-prompt \
    --output prompt.txt
```

### Generate Prompt Without Saving to File

If you just want to see the prompt without saving:

```bash
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --input target_article.txt \
    --use-saved-style "幽默短篇故事" \
    --generate-prompt
```

### Programmatic Usage

You can also use Python to manage rewrite history programmatically:

```python
from utils import (
    add_rewrite_history,
    list_rewrite_history,
    get_rewrite_history_by_style,
    get_rewrite_history_entry,
    delete_rewrite_history_entry
)

# Save to history
entry_id = add_rewrite_history(
    style_name="幽默短篇故事",
    original_content="原文...",
    rewritten_content="重写后...",
    original_file="input.txt",
    prompt_file="prompt.txt",
    notes="备注信息"
)

# List all history (limit to 10 most recent)
history = list_rewrite_history(limit=10)

# Get history by style
style_history = get_rewrite_history_by_style("幽默短篇故事")

# Get specific entry
entry = get_rewrite_history_entry(entry_id)

# Delete entry
success = delete_rewrite_history_entry(entry_id)
```

## Advanced Usage Examples

### Batch Rewrite Multiple Articles

```bash
# Create a loop to process multiple articles
for article in article1.txt article2.txt article3.txt; do
    # Generate prompt
    uv run python skills/article-rewriter/scripts/rewrite_article.py \
        --input "$article" \
        --use-saved-style "娓娓道来" \
        --generate-prompt \
        --output "prompt_${article%.txt}.txt"

    # (Send prompt to LLM and save result to result_${article%.txt}.txt)

    # Save to history
    uv run python skills/article-rewriter/scripts/rewrite_article.py \
        --input "$article" \
        --use-saved-style "娓娓道来" \
        --save-to-history \
        --rewrite-result "result_${article%.txt}.txt"
done
```

### Compare Different Styles

```bash
# Rewrite same article with different styles
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --input article.txt --use-saved-style "幽默" \
    --generate-prompt --output prompt_humor.txt

uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --input article.txt --use-saved-style "娓娓道来" \
    --generate-prompt --output prompt_story.txt

# Compare the results after LLM processing
```

### Using Style-Specific Additional Instructions

Some saved styles may have `additional_instructions` embedded. These are automatically merged with any `--instructions` you provide:

```bash
# If the style has additional_instructions, they will be combined
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --input article.txt \
    --use-saved-style "幽默短篇故事" \
    --instructions "增加更多反转" \
    --generate-prompt \
    --output prompt.txt
```

## Best Practices

### 1. Organize Your Rewrites

- Use meaningful notes when saving to history
- Export important rewrites to separate files
- Delete outdated or failed attempts

### 2. Validate Quality

After generating a rewrite:

```bash
# View the history entry details
uv run python skills/article-rewriter/scripts/rewrite_article.py --list-history

# Export and review the content
uv run python skills/article-rewriter/scripts/rewrite_article.py \
    --export-history 1 --output review.txt

# If unsatisfied, delete and retry
uv run python skills/article-rewriter/scripts/rewrite_article.py --delete-history 1
```

### 3. Iterate on Styles

If a rewrite doesn't match expectations:

1. Review the style description: `uv run python skills/style-generator/scripts/generate_style.py --list-styles`
2. Generate a refined prompt with specific instructions
3. Save both versions to history for comparison

### 4. Maintain Original Content

Always keep original files. The history system stores original content for reference, but maintain source files as the single source of truth.

## Data Files

### `data/articles.json`

Stores style definitions and reference articles. Managed by `style-generator` skill.

### `data/rewrite_history.json`

Stores rewrite history entries independent of style references:

```json
{
  "history": [
    {
      "id": 1,
      "timestamp": "2026-02-03 14:30:00",
      "style_name": "幽默短篇故事",
      "original_file": "article.txt",
      "original_content": "...",
      "rewritten_content": "...",
      "prompt_file": "prompt.txt",
      "notes": "测试重写"
    }
  ],
  "metadata": {
    "version": "1.0",
    "description": "文章重写历史记录，独立于风格参考文章"
  }
}
```

## Important Notes

- Style adherence is top priority
- If style description is unclear, ask for clarification before rewriting
- Maintain factual accuracy - never alter facts to fit style
- When in doubt between style and accuracy, choose accuracy but note the compromise
- Rewrite history is stored separately from style reference articles for better organization
- Use `--notes` to tag and organize your rewrites for easy retrieval
- Temporary files (prompt.txt, rewritten.txt) are automatically cleaned up when saving to history

## Troubleshooting

### Style Not Found

```
错误：未找到名为 'xxx' 的风格
```

Solution: Check available styles with `--list-styles` and use exact name.

### History File Issues

If `data/rewrite_history.json` becomes corrupted:

```bash
# Backup current history
cp data/rewrite_history.json data/rewrite_history.json.bak

# The script will recreate the file on next save if missing
```

### Import Errors

If you see import errors, ensure:

1. You're in the project root directory
2. Virtual environment is activated: `.venv\Scripts\activate` (Windows)
3. Dependencies are installed: `uv sync`
